# Legal Redaction æ³•å¾‹æ–‡ä»¶è„±æ•å¹³å°

<p align="center">
  <strong>é¢å‘å¾‹å¸ˆçš„æ™ºèƒ½æ–‡ä»¶è„±æ•å¹³å°</strong><br>
  æ”¯æŒ Word / PDF / å›¾ç‰‡æ•æ„Ÿä¿¡æ¯è¯†åˆ«ä¸è„±æ•å¤„ç†<br>
  <b>å…¨é“¾è·¯æœ¬åœ°æ¨ç†ï¼Œæ— äº‘ç«¯ä¾èµ–</b>
</p>

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

| æ¨¡å— | è¯´æ˜ |
|------|------|
| ğŸ“„ **å¤šæ ¼å¼æ”¯æŒ** | Word (.doc/.docx)ã€PDFã€å›¾ç‰‡ (.jpg/.png) |
| ğŸ§  **OCR + NER åŒå¼•æ“** | PaddleOCR-VL-1.5ï¼ˆæ–‡å­—è¯†åˆ«ï¼‰+ HaS 4.0ï¼ˆå‘½åå®ä½“è¯†åˆ«ï¼‰ |
| ğŸ‘ï¸ **æœ¬åœ°è§†è§‰è¯†åˆ«** | GLM-4.6V-Flashï¼ˆç­¾å/å…¬ç« /æŒ‡çº¹/äºŒç»´ç /å¹¿å‘Šæ°´å°ç­‰ï¼‰ |
| âœï¸ **äº¤äº’å¼ç¼–è¾‘** | è¯†åˆ«ç»“æœå¯é€‰ / å¯ç¼–è¾‘ / å¯æ‹‰æ¡†è°ƒæ•´ |
| ğŸ”„ **è„±æ•æ¨¡å¼** | æ™ºèƒ½æ›¿æ¢ / æ©ç  / ç»“æ„åŒ–æ›¿æ¢ |
| ğŸ“Š **å¯¹æ¯”ä¸å¯¼å‡º** | è„±æ•å‰åå¯¹æ¯”é¢„è§ˆã€ä¸‹è½½ |
| ğŸ§ª **æµ‹è¯•ç”¨ä¾‹** | `testdata/ce.png` |

---

## ğŸ—ï¸ æ¶æ„æ€»è§ˆ

æœ¬é¡¹ç›®é‡‡ç”¨**åŒ Pipeline æ··åˆæ£€æµ‹æ¶æ„**ï¼Œå°† OCR æ–‡å­—è¯†åˆ«ã€NER è¯­ä¹‰ç†è§£ã€è§†è§‰å¤§æ¨¡å‹ä¸‰è€…æœ‰æœºç»“åˆï¼Œå®ç°å¯¹æ³•å¾‹æ–‡ä¹¦ä¸­å„ç±»æ•æ„Ÿä¿¡æ¯çš„ç²¾å‡†å®šä½ä¸è„±æ•ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶                                    â”‚
â”‚                    (Word / PDF / å›¾ç‰‡)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ–‡ä»¶è§£æ & å›¾åƒæå–                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Pipeline 1: OCR + HaS   â”‚   â”‚  Pipeline 2: GLM Vision   â”‚
    â”‚   (æ–‡å­—ç±»æ•æ„Ÿä¿¡æ¯)          â”‚   â”‚  (è§†è§‰ç±»æ•æ„Ÿä¿¡æ¯)          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â–¼                               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  PaddleOCR-VL-1.5         â”‚   â”‚  GLM-4.6V-Flash           â”‚
    â”‚  â”œâ”€ æ–‡å­—æ£€æµ‹ + è¯†åˆ«        â”‚   â”‚  â”œâ”€ å…¬ç« /å°ç« æ£€æµ‹          â”‚
    â”‚  â”œâ”€ ç‰ˆé¢åˆ†æ              â”‚   â”‚  â”œâ”€ æ‰‹å†™ç­¾åè¯†åˆ«           â”‚
    â”‚  â””â”€ ç²¾ç¡®åæ ‡å®šä½           â”‚   â”‚  â”œâ”€ æŒ‡çº¹/ç…§ç‰‡æ£€æµ‹          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€ äºŒç»´ç /æ°´å°è¯†åˆ«        â”‚
                    â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼                               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
    â”‚  HaS 4.0 (Qwen3-0.6B)     â”‚                   â”‚
    â”‚  â”œâ”€ å‘½åå®ä½“è¯†åˆ« (NER)     â”‚                   â”‚
    â”‚  â”œâ”€ è¯­ä¹‰ç†è§£              â”‚                   â”‚
    â”‚  â””â”€ æŒ‡ä»£æ¶ˆè§£              â”‚                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
                    â”‚                               â”‚
                    â–¼                               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  æ–‡å­—åŒ¹é…å®šä½              â”‚   â”‚  åæ ‡å½’ä¸€åŒ–               â”‚
    â”‚  (å®ä½“ â†’ OCR åæ ‡)        â”‚   â”‚  (0-1 ç›¸å¯¹åæ ‡)           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      IoU å»é‡ & ç»“æœèåˆ       â”‚
                    â”‚  (OCR ä¼˜å…ˆï¼ŒGLM è¡¥å……)          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      äº¤äº’å¼ç¼–è¾‘ & è„±æ•åº”ç”¨      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”¬ è„±æ•ç®—æ³•è¯¦è§£

### 1. åŒ Pipeline æ··åˆæ£€æµ‹

æ³•å¾‹æ–‡ä¹¦ä¸­çš„æ•æ„Ÿä¿¡æ¯å¯åˆ†ä¸ºä¸¤å¤§ç±»ï¼š

| ç±»åˆ« | æ•æ„Ÿä¿¡æ¯ç±»å‹ | æ£€æµ‹æ–¹å¼ |
|------|-------------|---------|
| **æ–‡å­—ç±»** | å§“åã€èº«ä»½è¯å·ã€ç”µè¯ã€é“¶è¡Œå¡å·ã€åœ°å€ã€å…¬å¸åç­‰ | OCR + HaS NER |
| **è§†è§‰ç±»** | å…¬ç« ã€ç­¾åã€æŒ‡çº¹ã€ç…§ç‰‡ã€äºŒç»´ç ã€æ°´å°ç­‰ | GLM Vision |

ä¼ ç»Ÿ OCR æ–¹æ¡ˆåªèƒ½è¯†åˆ«æ–‡å­—ï¼Œæ— æ³•å¤„ç†å°ç« ã€ç­¾åç­‰è§†è§‰å…ƒç´ ï¼›è€Œçº¯è§†è§‰å¤§æ¨¡å‹è™½ç„¶èƒ½è¯†åˆ«å›¾åƒå†…å®¹ï¼Œä½†åœ¨ç²¾ç¡®å®šä½æ–‡å­—è¾¹ç•Œä¸Šå­˜åœ¨è¯¯å·®ã€‚æœ¬é¡¹ç›®å°†ä¸¤è€…ä¼˜åŠ¿ç»“åˆï¼š

- **OCR + HaS Pipeline**ï¼šæ“…é•¿ç²¾å‡†å®šä½æ–‡å­—ç±»æ•æ„Ÿä¿¡æ¯ï¼Œåæ ‡ç²¾ç¡®åˆ°åƒç´ çº§
- **GLM Vision Pipeline**ï¼šæ“…é•¿è¯†åˆ«è§†è§‰ç±»æ•æ„Ÿå…ƒç´ ï¼Œå¼¥è¡¥ OCR çš„ç›²åŒº

ä¸¤æ¡ Pipeline **å¹¶è¡Œè¿è¡Œ**ï¼Œæœ€åé€šè¿‡ IoUï¼ˆäº¤å¹¶æ¯”ï¼‰ç®—æ³•å»é‡èåˆï¼Œç¡®ä¿ä¸é—æ¼ã€ä¸é‡å¤ã€‚

### 2. OCR + HaS Pipeline å·¥ä½œæµç¨‹

è¿™æ˜¯å¤„ç†æ–‡å­—ç±»æ•æ„Ÿä¿¡æ¯çš„æ ¸å¿ƒæµç¨‹ï¼š

```
åŸå§‹å›¾åƒ
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: PaddleOCR-VL æ–‡å­—æ£€æµ‹                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ æ£€æµ‹å›¾åƒä¸­æ‰€æœ‰æ–‡å­—åŒºåŸŸ                                      â”‚
â”‚  â€¢ è¯†åˆ«æ–‡å­—å†…å®¹                                              â”‚
â”‚  â€¢ è¿”å›æ¯ä¸ªæ–‡å­—å—çš„ç²¾ç¡®åæ ‡ (å››è¾¹å½¢é¡¶ç‚¹)                        â”‚
â”‚  â€¢ åŒæ—¶æ£€æµ‹å…¬ç« ç­‰è§†è§‰å…ƒç´                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚  è¾“å‡º: [{text: "å¼ ä¸‰", polygon: [[x1,y1]...]}, ...]
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: HaS å‘½åå®ä½“è¯†åˆ« (NER)                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ å°†æ‰€æœ‰ OCR æ–‡å­—æ‹¼æ¥æˆå®Œæ•´æ–‡æœ¬                               â”‚
â”‚  â€¢ è°ƒç”¨ HaS æ¨¡å‹è¿›è¡Œè¯­ä¹‰åˆ†æ                                   â”‚
â”‚  â€¢ è¯†åˆ«æ•æ„Ÿå®ä½“ç±»å‹ï¼ˆäººåã€èº«ä»½è¯ã€ç”µè¯ç­‰ï¼‰                       â”‚
â”‚  â€¢ æ”¯æŒè‡ªå®šä¹‰å®ä½“ç±»å‹                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚  è¾“å‡º: [{type: "PERSON", text: "å¼ ä¸‰"}, {type: "PHONE", text: "13800138000"}]
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: å®ä½“-åæ ‡åŒ¹é…                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ åœ¨ OCR æ–‡å­—å—ä¸­æŸ¥æ‰¾æ¯ä¸ªæ•æ„Ÿå®ä½“                             â”‚
â”‚  â€¢ ç²¾ç¡®åŒ¹é…ï¼šentity_text in block_text                       â”‚
â”‚  â€¢ æ¨¡ç³ŠåŒ¹é…ï¼šSequenceMatcher > 0.85 (å¤„ç† OCR è¯†åˆ«è¯¯å·®)        â”‚
â”‚  â€¢ å­è¯å®šä½ï¼šæ ¹æ®å­—ç¬¦ä½ç½®æ¯”ä¾‹è®¡ç®—åƒç´ åæ ‡                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚  è¾“å‡º: [{type: "PERSON", text: "å¼ ä¸‰", x: 100, y: 200, w: 50, h: 20}]
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: æ­£åˆ™è§„åˆ™è¡¥å……                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ èº«ä»½è¯å·: [1-9]\d{5}(19|20)\d{2}(0[1-9]|1[0-2])...        â”‚
â”‚  â€¢ æ‰‹æœºå·: 1[3-9]\d{9}                                       â”‚
â”‚  â€¢ é“¶è¡Œå¡å·: [3-6]\d{15,18}                                  â”‚
â”‚  â€¢ é‚®ç®±: [a-zA-Z0-9._%+-]+@...                               â”‚
â”‚  â€¢ ä¸ NER ç»“æœåˆå¹¶å»é‡                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ºä»€ä¹ˆè¦åˆ†ç¦» OCR å’Œ NERï¼Ÿ**

è¿™æ˜¯æœ¬é¡¹ç›®çš„æ ¸å¿ƒè®¾è®¡ç†å¿µã€‚ä¼ ç»Ÿæ–¹æ¡ˆè®©å¤§æ¨¡å‹åŒæ—¶åš OCR å’Œ NERï¼Œä½†è¿™ä¼šå¯¼è‡´ï¼š
- åæ ‡ä¸ç²¾ç¡®ï¼ˆå¤§æ¨¡å‹è¿”å›çš„åæ ‡å¸¸æœ‰åå·®ï¼‰
- æ¨ç†é€Ÿåº¦æ…¢ï¼ˆè§†è§‰+è¯­è¨€åŒé‡è®¡ç®—ï¼‰
- éš¾ä»¥å¤„ç†å¤æ‚ç‰ˆé¢ï¼ˆè¡¨æ ¼ã€å¤šæ ç­‰ï¼‰

æœ¬é¡¹ç›®é‡‡ç”¨**åˆ†å·¥åä½œ**ç­–ç•¥ï¼š
- **PaddleOCR-VL**ï¼šä¸“æ³¨æ–‡å­—æ£€æµ‹ï¼Œæä¾›åƒç´ çº§ç²¾ç¡®åæ ‡
- **HaS**ï¼šä¸“æ³¨è¯­ä¹‰ç†è§£ï¼Œè¯†åˆ«æ•æ„Ÿå®ä½“ç±»å‹
- **æ–‡å­—åŒ¹é…**ï¼šå°†ä¸¤è€…ç»“æœå…³è”ï¼Œå®ç°ç²¾å‡†å®šä½

### 3. GLM Vision Pipeline å·¥ä½œæµç¨‹

å¤„ç†è§†è§‰ç±»æ•æ„Ÿä¿¡æ¯ï¼š

```
åŸå§‹å›¾åƒ
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GLM-4.6V-Flash è§†è§‰æ£€æµ‹                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ è¾“å…¥ï¼šå›¾åƒ + æ£€æµ‹ç±»å‹æç¤ºè¯                                 â”‚
â”‚  â€¢ è¾“å‡ºï¼šæ•æ„ŸåŒºåŸŸåæ ‡ (å½’ä¸€åŒ– 0-1)                             â”‚
â”‚  â€¢ æ”¯æŒç±»å‹ï¼šå…¬ç« ã€ç­¾åã€æŒ‡çº¹ã€ç…§ç‰‡ã€äºŒç»´ç ã€æ°´å°ç­‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚  è¾“å‡º: [{type: "SEAL", x: 0.7, y: 0.8, w: 0.15, h: 0.1}]
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åæ ‡è‡ªé€‚åº”å¤„ç†                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ è‡ªåŠ¨è¯†åˆ«åæ ‡æ¨¡å¼ (0-1 / 0-1000 / åƒç´ )                     â”‚
â”‚  â€¢ ç»Ÿä¸€å½’ä¸€åŒ–åˆ° 0-1 ç›¸å¯¹åæ ‡                                  â”‚
â”‚  â€¢ è¾¹ç•Œä¿®æ­£ (ç¡®ä¿ä¸è¶…å‡ºå›¾åƒèŒƒå›´)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. ç»“æœèåˆä¸å»é‡

ä¸¤æ¡ Pipeline çš„ç»“æœéœ€è¦æ™ºèƒ½èåˆï¼š

```python
def deduplicate_boxes(boxes, iou_threshold=0.3):
    """
    å»é‡ç­–ç•¥ï¼š
    1. OCR ç»“æœå…¨éƒ¨ä¿ç•™ï¼ˆåæ ‡æ›´ç²¾ç¡®ï¼‰
    2. GLM ç»“æœï¼šåªä¿ç•™ä¸ OCR ä¸é‡å çš„
    3. é‡å åˆ¤æ–­ï¼šIoU > 0.3 è§†ä¸ºé‡å¤
    """
    ocr_boxes = [b for b in boxes if b.source == "ocr_has"]
    glm_boxes = [b for b in boxes if b.source == "glm_vision"]
    
    result = list(ocr_boxes)  # OCR ä¼˜å…ˆ
    
    for glm_box in glm_boxes:
        is_duplicate = any(
            calculate_iou(glm_box, ocr_box) > iou_threshold
            for ocr_box in ocr_boxes
        )
        if not is_duplicate:
            result.append(glm_box)
    
    return result
```

### 5. æ•æ„Ÿä¿¡æ¯åˆ†ç±»ä½“ç³»

åŸºäº **GB/T 37964-2019ã€Šä¿¡æ¯å®‰å…¨æŠ€æœ¯ ä¸ªäººä¿¡æ¯å»æ ‡è¯†åŒ–æŒ‡å—ã€‹** æ„å»ºï¼š

| åˆ†ç±» | ç±»å‹ ID | è¯´æ˜ | æ£€æµ‹æ–¹å¼ |
|------|---------|------|---------|
| **ç›´æ¥æ ‡è¯†ç¬¦** | PERSON | å§“å | HaS NER |
| | ID_CARD | èº«ä»½è¯å· | æ­£åˆ™ + NER |
| | PHONE | ç”µè¯å·ç  | æ­£åˆ™ + NER |
| | EMAIL | ç”µå­é‚®ç®± | æ­£åˆ™ |
| | BANK_CARD | é“¶è¡Œå¡å· | æ­£åˆ™ + NER |
| | BANK_ACCOUNT | é“¶è¡Œè´¦å· | NER |
| **å‡†æ ‡è¯†ç¬¦** | COMPANY | å…¬å¸åç§° | NER |
| | ADDRESS | è¯¦ç»†åœ°å€ | NER |
| | DATE | æ—¥æœŸ | æ­£åˆ™ + NER |
| | LICENSE_PLATE | è½¦ç‰Œå· | æ­£åˆ™ |
| | CASE_NUMBER | æ¡ˆä»¶ç¼–å· | NER |
| **è§†è§‰å…ƒç´ ** | SEAL | å…¬ç« /å°ç«  | GLM Vision |
| | SIGNATURE | æ‰‹å†™ç­¾å | GLM Vision |
| | FINGERPRINT | æŒ‡çº¹ | GLM Vision |
| | PHOTO | ç…§ç‰‡/å¤´åƒ | GLM Vision |
| | QR_CODE | äºŒç»´ç  | GLM Vision |

---

## ğŸ“¦ æ¨¡å‹ä¸æœåŠ¡

| æœåŠ¡ | æ¨¡å‹/ç»„ä»¶ | ç”¨é€” | ç«¯å£ |
|------|----------|------|------|
| **Backend API** | FastAPI | ä¸»åç«¯æœåŠ¡ | 8000 |
| **OCR** | PaddleOCR-VL-1.5 | æ–‡å­—æ£€æµ‹ä¸è¯†åˆ« | 8082 |
| **NER** | HaS 4.0 (Qwen3-0.6B) | å‘½åå®ä½“è¯†åˆ« | 8080 |
| **Vision** | GLM-4.6V-Flash-Q4_K_M | è§†è§‰æ•æ„ŸåŒºåŸŸæ£€æµ‹ | 8081 |
| **MCP** | Image-MCP | å›¾åƒå¤„ç†ä¸­é—´ä»¶ | 8090 |
| **Frontend** | React + Vite | å‰ç«¯ç•Œé¢ | 3000 |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**ï¼šWindows 10/11 æˆ– Linuxï¼ˆWSL2 å¯é€‰ï¼‰
- **Python**ï¼š3.10+
- **Node.js**ï¼š18+
- **GPU**ï¼šNVIDIAï¼ˆå»ºè®® RTX 4060 åŠä»¥ä¸Šï¼Œ8GB+ æ˜¾å­˜ï¼‰

### ç›®å½•ç»“æ„ï¼ˆå»ºè®®ï¼‰

```
<ä½ çš„å·¥ä½œç›®å½•>/
â”œâ”€â”€ llama.cpp/                  # llama.cpp å¯æ‰§è¡Œæ–‡ä»¶
â”‚   â””â”€â”€ llama-server.exe        # æˆ– llama-serverï¼ˆLinuxï¼‰
â”œâ”€â”€ glm-models/                 # GLM æ¨¡å‹æƒé‡
â”‚   â”œâ”€â”€ GLM-4.6V-Flash-Q4_K_M.gguf
â”‚   â””â”€â”€ mmproj-F16.gguf
â””â”€â”€ legal-redaction/            # æœ¬é¡¹ç›®
    â”œâ”€â”€ backend/
    â”œâ”€â”€ frontend/
    â””â”€â”€ ...
```

> **æç¤º**ï¼šä»¥ä¸‹å‘½ä»¤ä¸­çš„è·¯å¾„è¯·æ ¹æ®ä½ çš„å®é™…ç›®å½•ç»“æ„è°ƒæ•´ã€‚

---

### 1ï¸âƒ£ å¯åŠ¨ GLM Visionï¼ˆæœ¬åœ°è§†è§‰æœåŠ¡ï¼‰

```bash
# Windows PowerShell
cd <llama.cppç›®å½•>
.\llama-server.exe ^
  -m <glm-modelsç›®å½•>\GLM-4.6V-Flash-Q4_K_M.gguf ^
  --mmproj <glm-modelsç›®å½•>\mmproj-F16.gguf ^
  --port 8081 -ngl 99 --ctx-size 4096 --jinja ^
  --flash-attn on --reasoning-budget 0 --mlock -np 1 -ub 1024
```

```bash
# Linux / WSL2
./llama-server \
  -m ../glm-models/GLM-4.6V-Flash-Q4_K_M.gguf \
  --mmproj ../glm-models/mmproj-F16.gguf \
  --port 8081 -ngl 99 --ctx-size 4096 --jinja \
  --flash-attn on --reasoning-budget 0 --mlock -np 1 -ub 1024
```

---

### 2ï¸âƒ£ å¯åŠ¨ HaSï¼ˆæœ¬åœ° NER æœåŠ¡ï¼‰

```bash
# Windows
.\llama-server.exe -hf xuanwulab/HaS_4.0_0.6B_GGUF --port 8080 -ngl 99
```

```bash
# Linux / WSL2
./llama-server -hf xuanwulab/HaS_4.0_0.6B_GGUF --port 8080 -ngl 99
```

---

### 3ï¸âƒ£ å¯åŠ¨åç«¯

```bash
cd backend
python -m venv venv        # æˆ–ä½¿ç”¨ conda
source venv/bin/activate   # Windows: venv\Scripts\activate
pip install -r requirements.txt

# å¯åŠ¨ OCR å¾®æœåŠ¡ï¼ˆç«¯å£ 8082ï¼‰
python ocr_server.py &

# å¯åŠ¨ MCP å›¾åƒæœåŠ¡ï¼ˆç«¯å£ 8090ï¼Œå¯é€‰ï¼‰
python mcp_image_server.py &

# å¯åŠ¨ä¸»åç«¯ï¼ˆç«¯å£ 8000ï¼‰
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

---

### 4ï¸âƒ£ å¯åŠ¨å‰ç«¯

```bash
cd frontend
npm install
npm run dev -- --port 3000
```

è®¿é—®ï¼š**http://localhost:3000**

---

### ğŸš€ ä¸€é”®å¯åŠ¨ï¼ˆWindows PowerShellï¼‰

å‡è®¾ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š
- `D:\llama.cpp\` - llama.cpp å¯æ‰§è¡Œæ–‡ä»¶
- `D:\glm-models\` - æ¨¡å‹æ–‡ä»¶
- `D:\legal-redaction\` - æœ¬é¡¹ç›®

```powershell
# 1. HaS NER æœåŠ¡ (ç«¯å£ 8080)
Start-Process -FilePath "D:\llama.cpp\llama-server.exe" -ArgumentList "-m D:\glm-models\has_4.0_0.6B_q4.gguf -ngl 99 --host 0.0.0.0 --port 8080"

# 2. GLM-4.6V è§†è§‰æœåŠ¡ (ç«¯å£ 8081)
Start-Process -FilePath "D:\llama.cpp\llama-server.exe" -ArgumentList "-m D:\glm-models\GLM-4.6V-Flash-Q4_K_M.gguf --mmproj D:\glm-models\mmproj-F16.gguf -ngl 99 --host 0.0.0.0 --port 8081"

# 3. PaddleOCR-VL æœåŠ¡ (ç«¯å£ 8082)
Start-Process powershell -ArgumentList "-Command cd D:\legal-redaction\backend; conda activate oda; python ocr_server.py"

# 4. MCP å›¾åƒæœåŠ¡ (ç«¯å£ 8090)
Start-Process powershell -ArgumentList "-Command cd D:\legal-redaction\backend; conda activate oda; python mcp_image_server.py"

# 5. åç«¯ API (ç«¯å£ 8000)
Start-Process powershell -ArgumentList "-Command cd D:\legal-redaction\backend; conda activate oda; python -m uvicorn app.main:app --host 0.0.0.0 --port 8000"

# 6. å‰ç«¯ (ç«¯å£ 3000)
Start-Process powershell -ArgumentList "-Command cd D:\legal-redaction\frontend; npm run dev"
```

**éªŒè¯æœåŠ¡çŠ¶æ€ï¼š**
```powershell
Invoke-RestMethod -Uri "http://127.0.0.1:8000/health/services" | ConvertTo-Json
```

---

## ğŸ› ï¸ æœ¬åœ°æ¨¡å‹éƒ¨ç½²è¸©å‘è®°å½•

### GLM-4.6V-Flashï¼ˆé‡ç‚¹ï¼‰

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| `unknown projector type: glm4v` | ä½¿ç”¨ **b7897+** ç‰ˆæœ¬çš„ llama.cppï¼ˆæ—§ç‰ˆä¸æ”¯æŒ glm4vï¼‰ |
| è§†è§‰è¯†åˆ«æ— å“åº” | å¿…é¡»å¸¦ `--mmproj mmproj-F16.gguf` |
| `expected value for argument` | `--flash-attn` æ–°ç‰ˆå¿…é¡»å†™æˆ `--flash-attn on` |
| æ¨ç†é€Ÿåº¦æ…¢ | æ·»åŠ  `--reasoning-budget 0` å…³é—­æ€è€ƒè¿‡ç¨‹ |
| è¾“å‡ºè‹±æ–‡è€Œéä¸­æ–‡ | åç«¯å·²å†…ç½® system prompt å¼ºåˆ¶ä¸­æ–‡è¾“å‡º |

**æ¨¡å‹ä¸‹è½½**ï¼š
- ä¸»æ¨¡å‹ï¼š[GLM-4.6V-Flash-Q4_K_M.gguf](https://huggingface.co/unsloth/GLM-4.6V-Flash-GGUF)
- è§†è§‰æŠ•å½±ï¼šåŒä»“åº“çš„ `mmproj-F16.gguf`

---

### PaddleOCR-VL-1.5

- é¦–æ¬¡å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½åˆ°æœ¬åœ°ç¼“å­˜ï¼ˆçº¦ 2GBï¼‰
- åç»­è¿è¡Œä¼šå¤ç”¨ç¼“å­˜ï¼Œæ— éœ€é‡å¤ä¸‹è½½

---

### HaSï¼ˆQwen3-0.6Bï¼‰

- é€šè¿‡ llama-server çš„ `-hf` å‚æ•°è‡ªåŠ¨æ‹‰å–
- åç«¯é»˜è®¤è¿æ¥ `http://127.0.0.1:8080/v1`

---

## ğŸ§ª ç¯å¢ƒæ£€æŸ¥

Windows PowerShellï¼š

```powershell
.\scripts\check_env.ps1
```

è„šæœ¬ä¼šæ£€æŸ¥ï¼š
- Python / Node / npm
- NVIDIA é©±åŠ¨
- æ¨¡å‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- å„æœåŠ¡ç«¯å£æ˜¯å¦ç›‘å¬

---

## ğŸ§ª å†’çƒŸæµ‹è¯•

è¯¦è§ï¼š`tests/smoke_test.md`

æµ‹è¯•ç”¨ä¾‹ï¼š`testdata/ce.png`

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
legal-redaction/
â”œâ”€â”€ backend/                 # FastAPI åç«¯
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/             # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ core/            # é…ç½®ã€GLM/HaS å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ services/        # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚       â”œâ”€â”€ vision_service.py      # åŒ Pipeline è°ƒåº¦
â”‚   â”‚       â”œâ”€â”€ hybrid_vision_service.py # OCR+HaS æ··åˆæœåŠ¡
â”‚   â”‚       â”œâ”€â”€ ocr_service.py         # PaddleOCR å®¢æˆ·ç«¯
â”‚   â”‚       â””â”€â”€ has_service.py         # HaS NER æœåŠ¡
â”‚   â”œâ”€â”€ ocr_server.py        # OCR å¾®æœåŠ¡å…¥å£
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ frontend/                # React + Vite å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/      # é€šç”¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ pages/           # é¡µé¢
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ scripts/                 # ç¯å¢ƒæ£€æŸ¥è„šæœ¬
â”œâ”€â”€ testdata/                # æµ‹è¯•ç”¨ä¾‹
â””â”€â”€ tests/                   # æµ‹è¯•æ¨¡æ¿
```

---

## ğŸ“– API æ–‡æ¡£

- **Swagger UI**ï¼šhttp://localhost:8000/docs
- **ReDoc**ï¼šhttp://localhost:8000/redoc

---

## ğŸ¯ é€‚ç”¨åœºæ™¯

æœ¬é¡¹ç›®ç‰¹åˆ«é€‚åˆä»¥ä¸‹ä¸šåŠ¡åœºæ™¯ï¼š

| åœºæ™¯ | è¯´æ˜ |
|------|------|
| **å¾‹æ‰€æ–‡ä¹¦è„±æ•** | åˆåŒã€åˆ¤å†³ä¹¦ã€èµ·è¯‰çŠ¶ç­‰æ³•å¾‹æ–‡ä¹¦çš„æ‰¹é‡è„±æ• |
| **è¯æ®ææ–™å¤„ç†** | èº«ä»½è¯ã€é“¶è¡Œæµæ°´ã€åˆåŒæ‰«æä»¶çš„æ•æ„Ÿä¿¡æ¯é®ç›– |
| **æ¡£æ¡ˆæ•°å­—åŒ–** | å†å²çº¸è´¨æ¡£æ¡ˆæ‰«æåçš„éšç§ä¿æŠ¤ |
| **æ•°æ®åˆè§„** | æ»¡è¶³ GDPRã€ã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹ç­‰åˆè§„è¦æ±‚ |

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿ Issue ä¸ PRï¼è¯¦è§ [CONTRIBUTING.md](./CONTRIBUTING.md)

---

## ğŸ“„ è®¸å¯è¯

[MIT License](./LICENSE)

---

## â­ Star History

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹ä¸ª Star â­
